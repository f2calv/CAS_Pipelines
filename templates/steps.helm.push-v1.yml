parameters:
- name: azureSubscription
  type: string
  default: $(azureSubscription)
- name: registry
  type: string
  default: $(acrName).azurecr.io
- name: repository
  type: string
  default: $(repository)
- name: repositoryFolder
  type: string
  default: $(repositoryFolder)
- name: tag
  type: string
  default: latest
- name: acrName
  type: string
  default: $(acrName)
- name: spId
  type: string
- name: spPassword
  type: string

steps:
# - task: AzureCLI@2
#   displayName: Login to Azure Container Registry
#   inputs:
#       azureSubscription: ${{ parameters.azureSubscription }}
#       scriptType: bash
#       scriptLocation: inlineScript
#       inlineScript: |
#         az acr login --name ${{ parameters.acrName }}
# - task: HelmInstaller@1
#     inputs:
#     helmVersionToInstall: latest
- bash: |
    helm registry login ${{ parameters.registry }} --username ${{ parameters.spId }} --password ${{ parameters.spPassword }}

    helm chart save ./${{ parameters.repositoryFolder }}/charts/${{ parameters.repository }} ${{ parameters.registry }}/charts/${{ parameters.repository }}:${{ parameters.tag }}
    helm chart push ${{ parameters.registry }}/charts/${{ parameters.repository }}:${{ parameters.tag }}