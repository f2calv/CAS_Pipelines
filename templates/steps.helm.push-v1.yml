parameters:
- name: azureSubscription
  type: string
  default: $(azureSubscription)
- name: acrName
  type: string
  default: $(acrName)
- name: repository
  type: string
  default: $(repository)
- name: imageRepositoryFolder
  type: string
  default: $(imageRepositoryFolder)
- name: spId
  type: string
- name: spPassword
  type: string

steps:
- task: AzureCLI@2
  displayName: Login to Azure Container Registry
  inputs:
      azureSubscription: ${{ parameters.azureSubscription }}
      scriptType: bash
      scriptLocation: inlineScript
      inlineScript: |
        az acr login --name ${{ parameters.acrName }}
# - task: HelmInstaller@1
#     inputs:
#     helmVersionToInstall: latest
- bash: |
    helm chart save ./${{ parameters.imageRepositoryFolder }}/charts/${{ parameters.repository }} ${{ parameters.acrName }}.azurecr.io/charts/${{ parameters.repository }}:latest
    helm registry login ${{ parameters.acrName }}.azurecr.io --username ${{ parameters.spId }} --password ${{ parameters.spPassword }}
    helm chart push ${{ parameters.acrName }}.azurecr.io/charts/${{ parameters.repository }}:latest
